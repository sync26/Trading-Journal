<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Trading Journal</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0f14; --panel:#0b1116; --card:#0c1319; --card-2:#0e151c;
  --border:#1a2630; --border-2:#223645; --text:#e7f3f0; --muted:#9fb2aa;
  --muted-2:#7f9490; --green:#7cff6b; --red:#ff6574; --blue:#6ab8ff;
  --shadow:0 20px 60px rgba(0,0,0,.45); --radius:16px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font:15px/1.55 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--text);
  background:radial-gradient(1200px 1200px at 20% -10%, #0f1720 0%, #0b1016 40%, #090d12 70%, var(--bg) 100%) fixed
}
.wrap{max-width:1280px;margin:24px auto;padding:12px}
.panel,.side{background:linear-gradient(180deg,#0b1116 0%,#0a0f14 100%);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
.grid{display:grid;grid-template-columns:1fr 360px;gap:22px}
@media (max-width:1100px){.grid{grid-template-columns:1fr}}
.panel-inner{padding:22px}
.head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.title{font-size:20px;letter-spacing:.1em;text-transform:uppercase}
.live{display:inline-flex;align-items:center;gap:8px;font-weight:600;color:var(--muted)}
.dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 16px var(--green)}
.stamp{color:var(--muted-2);font-size:12px}
.btn{display:inline-flex;align-items:center;gap:8px;background:#0cf05b;border:none;color:#05150c;font-weight:800;padding:10px 14px;border-radius:12px;cursor:pointer;box-shadow:0 8px 24px rgba(12,240,91,.2)}
.btn.secondary{background:transparent;color:#cfe9ff;border:1px solid var(--border-2);box-shadow:none}
.btn.small{padding:6px 10px;font-size:12px;border-radius:8px}
.btn.danger{background:transparent;color:#ff9aa5;border:1px solid #7a2b36}
.table{margin-top:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}
.thead,.trow{display:grid;grid-template-columns:160px 120px 120px 1fr 1fr 1fr 130px;align-items:center}
.thead{background:#0b151c;border-bottom:1px solid var(--border)}
.th,.td{padding:12px 14px;white-space:nowrap}
.th{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#c9d7d2}
.tbody{max-height:520px;overflow:auto}
.trow{border-top:1px solid var(--border)}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-weight:600;font-size:13px;border:1px solid transparent}
.long{color:#0c2;background:rgba(124,255,107,.06);border-color:rgba(124,255,107,.15)}
.short{color:#f77;background:rgba(255,101,116,.08);border-color:rgba(255,101,116,.18)}
.num{font-variant-numeric:tabular-nums lining-nums}
.profit-pos{color:var(--green);font-weight:700}
.profit-neg{color:var(--red);font-weight:700}
.side .head{padding:18px;border-bottom:1px solid var(--border)}
.sidetitle{display:flex;align-items:center;gap:8px}
.month{color:var(--muted);font-size:12px;margin-top:2px}
.stats{padding:14px 18px 18px}
.row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;color:var(--muted)}
.row strong{font-size:18px;color:var(--text)}
.kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:4px}
.kpi div{background:var(--card-2);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
.kpi h4{margin:0 0 2px 0;color:var(--muted);font-weight:600;font-size:11px;letter-spacing:.08em;text-transform:uppercase}
.kpi .win{color:var(--green);font-size:20px;font-weight:800}
.kpi .loss{color:var(--red);font-size:20px;font-weight:800}
.divider{height:1px;background:var(--border);margin:12px 0}
.npnl{display:flex;justify-content:space-between;align-items:center}
.side-actions{display:flex;gap:10px;margin:14px 18px 18px}
dialog{border:1px solid var(--border);border-radius:16px;max-width:720px;width:96%;background:#0b1116;color:var(--text);box-shadow:var(--shadow)}
dialog::backdrop{background:rgba(0,0,0,.65)}
.form{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;padding:18px}
.field{display:flex;flex-direction:column;gap:6px}
label{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:#c9d7d2}
input,select,textarea{background:#0c1319;border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:#fff;outline:none}
textarea{grid-column:1/-1;min-height:80px}
.form-actions{display:flex;justify-content:flex-end;gap:10px;padding:0 18px 18px}
</style>
</head>
<body>
<div class="wrap">
  <div class="grid">
    <section class="panel">
      <div class="panel-inner">
        <div class="head">
          <div class="title">TRADING JOURNAL</div>
          <div class="live"><span class="dot"></span> LIVE</div>
        </div>
        <div class="stamp" id="stamp">Last updated: —</div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin:14px 0">
          <button class="btn" id="btnAdd">+ Add Trade</button>
          <button class="btn secondary" id="btnImport">Import JSON</button>
          <button class="btn secondary" id="btnExport">Export JSON</button>
          <input type="file" id="fileImport" accept="application/json" hidden />
        </div>

        <div class="table" role="table" aria-label="Trading journal table">
          <div class="thead" role="row">
            <div class="th">Pair</div>
            <div class="th">Position</div>
            <div class="th">Size</div>
            <div class="th">Profit ($)</div>
            <div class="th">Loss ($)</div>
            <div class="th">Net P&amp;L</div>
            <div class="th">Actions</div>
          </div>
          <div class="tbody" id="tbody"></div>
        </div>
      </div>
    </section>

    <aside class="side">
      <div class="head">
        <div>
          <div class="sidetitle"><span class="dot"></span><strong>Summary</strong></div>
          <div class="month" id="monthLabel">—</div>
        </div>
      </div>
      <div class="stats">
        <div class="kpi">
          <div><h4>Wins</h4><div class="win num" id="win">0</div></div>
          <div><h4>Losses</h4><div class="loss num" id="loss">0</div></div>
        </div>
        <div class="divider"></div>
        <div class="row"><span>Profit</span><strong class="num" style="color:var(--green)" id="grossProfit">$0.00</strong></div>
        <div class="row"><span>Loss</span><strong class="num" style="color:var(--red)" id="grossLoss">-$0.00</strong></div>
        <div class="divider"></div>
        <div class="row" style="opacity:.9"><span>Total Trades</span><strong class="num" id="totalTrades">0</strong></div>
        <div class="divider"></div>
        <div class="row npnl"><span>Net P&amp;L</span><strong class="num" style="font-size:24px;color:var(--green)" id="netPnl">$0.00</strong></div>
        <div class="row" style="margin-top:10px"><span>Win Rate</span><strong class="num" id="winRate">0%</strong></div>
      </div>
      <div class="side-actions">
        <button class="btn secondary" id="btnReset" title="Clear all data on this device">Reset</button>
      </div>
    </aside>
  </div>
</div>

<!-- Dialog -->
<dialog id="dlgTrade">
  <form id="formTrade" method="dialog">
    <div class="form">
      <div class="field">
        <label for="f_pair">Pair</label>
        <input id="f_pair" name="pair" placeholder="BTC/USDT" required />
      </div>
      <div class="field">
        <label for="f_pos">Position</label>
        <select id="f_pos" name="position" required>
          <option>Long</option>
          <option>Short</option>
        </select>
      </div>
      <div class="field">
        <label for="f_size">Size</label>
        <input id="f_size" name="size" type="number" step="0.0001" placeholder="10" required />
      </div>
      <div class="field">
        <label for="f_profit">Profit ($)</label>
        <input id="f_profit" name="profit" type="number" step="0.01" value="0" required />
      </div>
      <div class="field">
        <label for="f_loss">Loss ($)</label>
        <input id="f_loss" name="loss" type="number" step="0.01" value="0" required />
      </div>
      <div class="field">
        <label for="f_wl">Win/Loss</label>
        <select id="f_wl" name="wl">
          <option value="auto">Auto from Net</option>
          <option>Win</option>
          <option>Loss</option>
        </select>
      </div>
      <div class="field" style="grid-column:1/-1">
        <label for="f_notes">Notes</label>
        <textarea id="f_notes" name="notes" placeholder="short note"></textarea>
      </div>
    </div>
    <div class="form-actions">
      <button class="btn secondary" value="cancel">Cancel</button>
      <button class="btn" id="btnSave" value="default">Save</button>
    </div>
  </form>
</dialog>

<script>
/* ===== util ===== */
const fmtUSD = n => new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:2}).format(Number(n||0));
const fmtNum = (n,fd=2) => new Intl.NumberFormat('en-US',{minimumFractionDigits:fd,maximumFractionDigits:fd}).format(Number(n||0));
const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC';
const stampEl = document.getElementById('stamp');
const updateStamp = ()=>{
  const now = new Date(), pad = n=>String(n).padStart(2,'0');
  stampEl.textContent = `Last updated: ${now.toLocaleDateString('en-GB')} , ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())} ${now.getHours()>=12?'PM':'AM'} ${tz}`;
};
/* ===== storage ===== */
const STORAGE_KEY = 'tj_trades_v1';
let trades = [];
let editIndex = null;
function load(){ try{ trades = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch{ trades=[]; } }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(trades)); updateStamp(); }
/* ===== elements ===== */
const tbody = document.getElementById('tbody');
const elWin = document.getElementById('win');
const elLoss = document.getElementById('loss');
const elGrossProfit = document.getElementById('grossProfit');
const elGrossLoss = document.getElementById('grossLoss');
const elTotal = document.getElementById('totalTrades');
const elNet = document.getElementById('netPnl');
const elWR = document.getElementById('winRate');
/* ===== helpers ===== */
const netPnl = t => Number(t.profit||0) - Number(t.loss||0);
/* ===== render ===== */
function render(){
  tbody.innerHTML='';
  trades.forEach((t,i)=>{
    const net = netPnl(t);
    const row = document.createElement('div');
    row.className='trow';
    row.innerHTML = `
      <div class="td num">${t.pair}</div>
      <div class="td"><span class="pill ${String(t.position||'Long').toLowerCase()}">${t.position||'Long'}</span></div>
      <div class="td num">${fmtNum(t.size,4)}</div>
      <div class="td num">${fmtNum(t.profit)}</div>
      <div class="td num">${fmtNum(t.loss)}</div>
      <div class="td num ${net>=0?'profit-pos':'profit-neg'}">${net>=0?'+':''}${fmtNum(Math.abs(net))}</div>
      <div class="td">
        <button class="btn secondary small" data-act="edit" data-i="${i}">Edit</button>
        <button class="btn danger small" data-act="del" data-i="${i}">Delete</button>
      </div>`;
    tbody.appendChild(row);
  });

  const wins = trades.filter(t=> (t.wl||'auto')==='Win' || ((t.wl||'auto')==='auto' && netPnl(t)>0)).length;
  const losses = trades.filter(t=> (t.wl||'auto')==='Loss' || ((t.wl||'auto')==='auto' && netPnl(t)<0)).length;
  let gp=0, gl=0; trades.forEach(t=>{ gp+=Math.max(0,Number(t.profit||0)); gl+=Math.max(0,Number(t.loss||0)); });
  const net = gp - gl; const wr = (wins+losses)>0 ? wins/(wins+losses)*100 : 0;
  elWin.textContent=wins; elLoss.textContent=losses;
  elGrossProfit.textContent=`${gp>0?'+':''}${fmtUSD(gp)}`;
  elGrossLoss.textContent=`-${fmtUSD(gl).replace('-','')}`;
  elTotal.textContent=trades.length;
  elNet.textContent=`${net>=0?'+':''}${fmtUSD(net)}`;
  elWR.textContent=`${wr.toFixed(2)}%`;
}
/* ===== actions ===== */
document.getElementById('btnAdd').addEventListener('click', ()=>{
  editIndex=null;
  document.getElementById('formTrade').reset();
  document.getElementById('f_profit').value=0;
  document.getElementById('f_loss').value=0;
  document.getElementById('dlgTrade').showModal();
});
document.getElementById('formTrade').addEventListener('submit', e=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const rec = {
    pair: String(f.get('pair')||'').trim(),
    position: f.get('position')||'Long',
    size: parseFloat(f.get('size')||'0'),
    profit: parseFloat(f.get('profit')||'0'),
    loss: parseFloat(f.get('loss')||'0'),
    wl: f.get('wl')||'auto',
    notes: String(f.get('notes')||'')
  };
  if(!rec.pair || !isFinite(rec.size)){ alert('Pair and Size are required.'); return; }
  if(editIndex!==null){
    const old = trades[editIndex]; trades[editIndex] = { ...old, ...rec }; editIndex=null;
  }else{
    trades.unshift({ id: crypto.randomUUID?crypto.randomUUID():String(Date.now()), ts: Date.now(), ...rec });
  }
  save(); render(); document.getElementById('dlgTrade').close();
});
tbody.addEventListener('click', e=>{
  const btn = e.target.closest('button[data-act]'); if(!btn) return;
  const i = Number(btn.dataset.i);
  if(btn.dataset.act==='edit'){
    editIndex = i; const t = trades[i];
    document.getElementById('f_pair').value = t.pair||'';
    document.getElementById('f_pos').value = t.position||'Long';
    document.getElementById('f_size').value = Number(t.size||0);
    document.getElementById('f_profit').value = Number(t.profit||0);
    document.getElementById('f_loss').value = Number(t.loss||0);
    document.getElementById('f_wl').value = t.wl || 'auto';
    document.getElementById('f_notes').value = t.notes || '';
    document.getElementById('dlgTrade').showModal();
  }else if(btn.dataset.act==='del'){
    if(confirm('Delete this trade?')){ trades.splice(i,1); save(); render(); }
  }
});
/* ===== import / export / reset ===== */
const inputFile = document.getElementById('fileImport');
document.getElementById('btnImport').addEventListener('click', ()=> inputFile.click());
inputFile.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    try{
      const data = JSON.parse(String(ev.target.result||'[]'));
      if(!Array.isArray(data)) throw new Error('Invalid format: must be an Array');
      trades = data.map(x=>({
        id: x.id ?? (crypto.randomUUID?crypto.randomUUID():String(Date.now()+Math.random())),
        ts: x.ts ?? Date.now(),
        pair: x.pair ?? '',
        position: x.position ?? 'Long',
        size: Number(x.size ?? 0),
        profit: Number(x.profit ?? 0),
        loss: Number(x.loss ?? 0),
        wl: x.wl ?? 'auto',
        notes: x.notes ?? ''
      }));
      save(); render();
    }catch(err){ alert('Import failed: '+err.message); }
  };
  reader.readAsText(f); e.target.value='';
});
document.getElementById('btnExport').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(trades,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const d = new Date();
  a.href = url;
  a.download = `trading-journal-${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}.json`;
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('btnReset').addEventListener('click', ()=>{
  if(confirm('Clear all trades on this device?')){ trades=[]; save(); render(); }
});
/* ===== boot ===== */
document.getElementById('monthLabel').textContent = new Date().toLocaleDateString('en-US',{month:'long',year:'numeric'});
load(); render(); updateStamp();
</script>
</body>
</html>
