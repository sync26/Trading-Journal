<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Journal</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c1018;--panel:#121826;--card:#161d2e;--border:#1e2740;
  --text:#dce3f0;--muted:#94a0b8;--green:#4fff9a;--red:#ff6574;--blue:#4db3ff;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:'Poppins',system-ui,sans-serif;
  background:var(--bg);color:var(--text)
}
.wrap{max-width:1200px;margin:24px auto;padding:0 16px}
h1{
  font-size:26px;
  margin:0 0 24px;
  font-weight:700;
  text-align:left;
  color:#4db3ff;
  letter-spacing:0.5px;
}
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.5)
}
.top-section{display:flex;flex-wrap:wrap;gap:20px;align-items:center}
.left-stats{
  flex:1 1 350px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:12px;
  align-content:start
}
.right-chart{flex:2 1 500px;min-width:320px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:12px;
  text-align:center
}
.label{font-size:12px;color:var(--muted)}
.value{font-weight:700;font-size:22px;margin-top:4px}
.value.green{color:var(--green)}.value.red{color:var(--red)}.value.blue{color:var(--blue)}
.card.roi-wide{
  grid-column:1 / -1;
  text-align:center;
  padding:18px;
  background:linear-gradient(180deg,#182234,#101621);
  border:1px solid #294065;
}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
button{
  background:#182234;
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  font-family:'Poppins',sans-serif;
}
button.btn{background:linear-gradient(180deg,#22345a,#182234);border-color:#33507c}
button.btn:hover{filter:brightness(1.1)}
button.red{background:linear-gradient(180deg,#4a1a1a,#2b1010);border-color:#7c2a2a}
table{width:100%;border-collapse:separate;border-spacing:0 6px}
thead th{font-size:12px;text-align:left;color:var(--muted);padding:4px 10px}
tbody td{
  padding:10px;
  background:var(--card);
  border-top:1px solid var(--border);
  border-bottom:1px solid var(--border)
}
tbody tr td:first-child{border-left:1px solid var(--border);border-radius:10px 0 0 10px}
tbody tr td:last-child{border-right:1px solid var(--border);border-radius:0 10px 10px 0}
.pill{display:inline-flex;padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px}
.pill.long{background:var(--blue);color:#081019}.pill.short{background:var(--red);color:#fff}
.pill.canceled{background:#5b677d;color:#fff}
/* Modal */
#modalOverlay{
  position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:10
}
#formModal{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:20px;
  width:90%;
  max-width:480px
}
label{display:flex;flex-direction:column;gap:6px;font-size:13px;color:var(--muted)}
input,select{
  background:var(--card);
  border:1px solid var(--border);
  color:var(--text);
  padding:8px;
  border-radius:8px
}
.modal-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:14px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Trading Journal</h1>
  <div class="panel">
    <div class="top-section">
      <div class="left-stats">
        <div class="card"><div class="label">Win Rate</div><div class="value blue" id="winrateText">0%</div></div>
        <div class="card"><div class="label">Total</div><div class="value" id="ttl">0</div></div>
        <div class="card"><div class="label">Win</div><div class="value green" id="wins">0</div></div>
        <div class="card"><div class="label">Loss</div><div class="value red" id="losses">0</div></div>
        <div class="card"><div class="label">Cancel</div><div class="value" id="cancels">0</div></div>
        <div class="card"><div class="label">Net P&L</div><div class="value green" id="netpnl">0</div></div>
        <div class="card roi-wide"><div class="label">ROI Total</div><div class="value blue" id="roitext">0%</div></div>
      </div>
      <div class="right-chart">
        <canvas id="pnlChart" height="160"></canvas>
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" id="addBtn">+ Tambah Trade</button>
      <button class="btn" id="exportBtn">Export JSON</button>
      <button class="btn" id="importBtn">Import JSON</button>
      <input type="file" id="importFile" accept="application/json" style="display:none">
    </div>

    <div style="overflow:auto">
      <table>
        <thead><tr><th>PAIR</th><th>SIZE</th><th>POSISI</th><th>PROFIT</th><th>LOSS</th><th>ROI (%)</th><th>HASIL</th><th>NOTES</th><th></th></tr></thead>
        <tbody id="rows"><tr class="empty"><td colspan="9">Belum ada data.</td></tr></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modalOverlay">
  <div id="formModal">
    <h2 style="color:var(--blue);margin-top:0">Tambah Trade</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <label>Pair<input id="pair" placeholder="ETHUSDT"></label>
      <label>Position<select id="position"><option>LONG</option><option>SHORT</option><option>NEUTRAL</option></select></label>
      <label>Size<input id="size" type="number" placeholder="0"></label>
      <label>Profit<input id="profit" type="number" placeholder="0"></label>
      <label>Loss<input id="loss" type="number" placeholder="0"></label>
      <label>ROI (%)<input id="roi" type="number" placeholder="0"></label>
      <label>Result<select id="result"><option>WIN</option><option>LOSS</option><option>CANCELED</option></select></label>
      <label style="grid-column:span 2">Notes<input id="notes" placeholder="Catatan"></label>
    </div>
    <div class="modal-actions">
      <button class="red" id="cancelBtn">Batal</button>
      <button class="btn" id="saveBtn">Simpan</button>
    </div>
  </div>
</div>

<script>
const KEY='trades.v1';
const CHART_KEY='chart.pnl.v1';
const q=id=>document.getElementById(id);
const load=()=>{try{return JSON.parse(localStorage.getItem(KEY))||[]}catch{return[]}};
const save=list=>localStorage.setItem(KEY,JSON.stringify(list));

const loadChartData=()=>{try{return JSON.parse(localStorage.getItem(CHART_KEY))||{labels:[],data:[]}}catch{return{labels:[],data:[]}}};
const saveChartData=d=>localStorage.setItem(CHART_KEY,JSON.stringify(d));

let pnlChart;
function initChart(){
  const ctx=q('pnlChart').getContext('2d');
  const stored=loadChartData();
  pnlChart=new Chart(ctx,{
    type:'line',
    data:{labels:stored.labels,datasets:[{label:'Net P&L',data:stored.data,borderColor:'#4db3ff',backgroundColor:'rgba(77,179,255,.15)',fill:true,tension:.25}]},
    options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#94a0b8'}},y:{ticks:{color:'#94a0b8'}}}}
  });
}
function updateChart(total){
  const cdata=loadChartData();
  const now=new Date().toLocaleDateString();
  cdata.labels.push(now);
  cdata.data.push(total);
  saveChartData(cdata);
  pnlChart.data.labels=cdata.labels;
  pnlChart.data.datasets[0].data=cdata.data;
  pnlChart.update();
}
function render(){
  const list=load(), tbody=q('rows');
  tbody.innerHTML='';
  if(!list.length){tbody.innerHTML='<tr class="empty"><td colspan="9">Belum ada data.</td></tr>';updateStats();return;}
  list.forEach((t,i)=>{
    const pill=t.result==='WIN'?'<span class="pill long">WIN</span>':t.result==='LOSS'?'<span class="pill short">LOSS</span>':'<span class="pill canceled">CANCELED</span>';
    const roiVal=(t.result==='LOSS'?-Math.abs(t.roi):Math.abs(t.roi))||0;
    tbody.innerHTML+=`<tr>
      <td><b>${t.pair}</b></td><td>${t.size||0}</td><td>${t.position}</td>
      <td style="color:var(--green)">${t.profit||0}</td><td style="color:var(--red)">${t.loss||0}</td>
      <td>${roiVal.toFixed(2)}%</td><td>${pill}</td>
      <td>${t.notes||''}</td>
      <td><button class="red" onclick="del(${i})">Hapus</button></td></tr>`;
  });
  updateStats();
}
function updateStats(){
  const all=load();
  const win=all.filter(t=>t.result==='WIN').length;
  const loss=all.filter(t=>t.result==='LOSS').length;
  const cancel=all.filter(t=>t.result==='CANCELED').length;
  const net=all.reduce((s,t)=>s+(+t.profit||0)-(+t.loss||0),0);
  const roi=all.reduce((s,t)=>s+(t.result==='WIN'?+t.roi:t.result==='LOSS'?-Math.abs(+t.roi):0),0);
  const wr=(win+loss)?Math.round((win/(win+loss))*100):0;
  q('wins').textContent=win;q('losses').textContent=loss;q('cancels').textContent=cancel;
  q('ttl').textContent=all.length;q('netpnl').textContent=net.toFixed(2);
  q('roitext').textContent=(roi>=0?'+':'')+roi.toFixed(2)+'%';
  q('winrateText').textContent=wr+'%';
  if(all.length)updateChart(net);
}
function addTrade(){
  const d={pair:q('pair').value.trim(),position:q('position').value,
    size:+q('size').value||0,profit:+q('profit').value||0,loss:+q('loss').value||0,roi:+q('roi').value||0,
    result:q('result').value,notes:q('notes').value.trim()};
  const arr=load();arr.push(d);save(arr);
}
function del(i){const arr=load();arr.splice(i,1);save(arr);render();}
function toggleModal(show){q('modalOverlay').style.display=show?'flex':'none';}

q('addBtn').onclick=()=>toggleModal(true);
q('cancelBtn').onclick=()=>toggleModal(false);
q('saveBtn').onclick=()=>{addTrade();toggleModal(false);render();};
q('exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(load(),null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');
  a.href=url;a.download='journal.json';a.click();URL.revokeObjectURL(url);
};
q('importBtn').onclick=()=>q('importFile').click();
q('importFile').onchange=e=>{
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{
      const data=JSON.parse(ev.target.result);
      if(Array.isArray(data)){save(data);render();}
      else alert('Format file tidak valid.');
    }catch{alert('Gagal membaca file JSON.');}
  };
  reader.readAsText(file);
};

initChart();
render();
</script>
</body>
</html>
